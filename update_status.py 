import sqlite3


def update_item_status():
    conn = sqlite3.connect('stationary_stock.db')
    cursor = conn.cursor()

    cursor.execute('SELECT id, reorder_level FROM items')
    items = cursor.fetchall()

    for item_id, reorder_level in items:
        update_single_item_status(cursor, item_id, reorder_level)

    conn.commit()
    conn.close()


def update_single_item_status(cursor, item_id, reorder_level):
    cursor.execute('SELECT IFNULL(SUM(stock), 0) FROM stocks WHERE item_id = ?', (item_id,))
    total_stock = cursor.fetchone()[0]

    status = 'GOOD' if total_stock > reorder_level else 'REORDER'

    cursor.execute('''
        UPDATE items
        SET total_stock = ?, status = ?
        WHERE id = ?
        ''', (total_stock, status, item_id))


if __name__ == '__main__':
    update_item_status()
